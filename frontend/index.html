<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pikachu Overlay</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <div id="character-container" class="draggable">
      <!-- Thought Bubble (always visible - shows listening/thinking status) -->
      <div id="thought-bubble" class="thought-bubble">
        <div class="bubble-content">
          <p id="thought-text">pikachu is listening...</p>
        </div>
      </div>
      
      <!-- Character Display -->
      <div id="character">
        <img src="assets/pikachu.svg" alt="Pikachu" class="pikachu-img" id="pikachu-img">
      </div>
    </div>
  </div>
  <script>
    (function() {
      // Lightweight global selection tracker available to all frontend scripts
      const SEL_MAX_CHARS = 8000;
      function getWindowSelection() {
        try {
          const sel = window.getSelection && window.getSelection();
          if (!sel) return '';
          const text = (sel.toString && sel.toString()) || '';
          const trimmed = text.trim();
          if (!trimmed) return '';
          return trimmed.length > SEL_MAX_CHARS ? trimmed.slice(0, SEL_MAX_CHARS) + '\n...[truncated]...' : trimmed;
        } catch (_) {
          return '';
        }
      }

      let currentSelection = '';
      function updateSelection() {
        currentSelection = getWindowSelection();
        window.__pikachuSelection = currentSelection;
      }

      document.addEventListener('mouseup', updateSelection, true);
      document.addEventListener('keyup', (e) => {
        if (e.key === 'Escape') {
          currentSelection = '';
          window.__pikachuSelection = '';
        } else {
          updateSelection();
        }
      }, true);

      // Initialize once DOM is interactive
      updateSelection();
    })();
  </script>
  <script src="renderer.js"></script>
  <script src="gemini-live.js"></script>
  <script type="module" src="static/js/overlay-audio.js"></script>
</body>
</html>
